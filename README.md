<p align="center">
  <img alt="GitHub language count" src="https://img.shields.io/github/languages/count/ivanqueiroz/transfer-scheduler?color=%2304D361">

  <img alt="Repository size" src="https://img.shields.io/github/repo-size/ivanqueiroz/transfer-scheduler">

  <a href="https://www.twitter.com/ivanqueiroz/">
    <img alt="Siga no Twitter" src="https://img.shields.io/twitter/url?url=https%3A%2F%2Fgithub.com%2Fivanqueiroz%2Ftransfer-scheduler">
  </a>

  <a href="https://github.com/ivanqueiroz/transfer-scheduler/commits/master">
    <img alt="GitHub last commit" src="https://img.shields.io/github/last-commit/ivanqueiroz/transfer-scheduler">
  </a>

   <img alt="License" src="https://img.shields.io/badge/license-MIT-brightgreen">
   <a href="https://github.com/ivanqueiroz/transfer-scheduler/stargazers">
    <img alt="Stargazers" src="https://img.shields.io/github/stars/ivanqueiroz/transfer-scheduler?style=social">
  </a>

  <a href="https://curriculo-ivanqueiroz.herokuapp.com/">
    <img alt="Feito por Ivan Queiroz" src="https://img.shields.io/badge/feito%20por-Ivan Queiroz-%237519C1">
  </a>

  <a href="https://ivanqueiroz.dev/">
    <img alt="Stargazers" src="https://img.shields.io/badge/Blog-Ivan Queiroz-%237159c1?style=flat&logo=ghost">
  </a>

  <img alt="Build Status" src="https://github.com/ivanqueiroz/transfer-scheduler/actions/workflows/gradle.yml/badge.svg">
</p>

<h4 align="center"> 
	üöß  Transfer Scheduler API :moneybag:Ô∏è Conclu√≠do üöÄ üöß
</h4>

<p align="center">
 <a href="#-sobre-o-projeto">Sobre</a> ‚Ä¢
 <a href="#%EF%B8%8F-funcionalidades">Funcionalidades</a> ‚Ä¢
 <a href="#open_book-documenta%C3%A7%C3%A3o-da-api">Documenta√ß√£o da API</a> ‚Ä¢ 
 <a href="#-como-executar-o-projeto">Como executar</a> ‚Ä¢ 
 <a href="#-tecnologias">Tecnologias</a> ‚Ä¢
 <a href="#transfer-scheduler#triangular_ruler-arquitetura">Arquitetura</a> ‚Ä¢
 <a href="#-contribuidores">Contribuidores</a> ‚Ä¢ 
 <a href="#-autor">Autor</a> 
</p>

## üíª Sobre o projeto

:moneybag: Transfer Scheduler ‚Äî √© uma API em REST que realiza o agendamento de transfer√™ncia financeiras.

---

## ‚öôÔ∏è Funcionalidades

- [x] Agendamento de transfer√™ncias
  - [x] C√°lculo da taxa da transfer√™ncia
- [x] Listagem de todas as transfer√™ncias agendadas
- [X] Internacionaliza√ß√£o das mensagens de erro

---

### Swagger

- http://localhost:8080/transfer/docs

---

## üöÄ Como executar o projeto

Este projeto inicia um servidor na porta 8080, pronto para receber requisi√ß√µes REST.

### Pr√©-requisitos

Antes de come√ßar, voc√™ vai precisar ter instalado na sua m√°quina as seguintes ferramentas:
[Git](https://git-scm.com), [Java 18+](https://www.oracle.com/java/technologies/downloads/#java18) e o [Gradle](https://docs.gradle.org/current/userguide/userguide.html).

Al√©m disso, √© bom ter uma IDE para trabalhar com o c√≥digo como [IDEA](https://www.jetbrains.com/pt-br/idea/download/) ou o [Spring Tools Suite](https://spring.io/tools).

Para testar a API √© necess√°ria uma ferramenta client REST como o [Postman](https://www.postman.com/downloads/).

#### üé≤ Rodando o Backend

```bash

# Clone este reposit√≥rio
$ git clone git@github.com:ivanqueiroz/transfer-scheduler.git

# Acesse a pasta do projeto no terminal/cmd
$ cd transfer-scheduler

# Instale as depend√™ncias
$ ./gradlew clean build (Linux) ou ./gradlew.bat clean build (Windows)

# Execute a aplica√ß√£o em modo de desenvolvimento
$ ./gradlew bootRun (Linux) ou ./gradlew.bat bootRun (Windows)

# O servidor inciar√° na porta:8080 - acesse http://localhost:8080 
```

## Get (Listar agendamentos)

Parametros Consulta

- Endpoint: http://localhost:8080/transfer/v1/schedule?page=0&size=20
- page = Pagina atual. Default = 0
- size = Tamanho da p√°gina a ser buscada no banco. Default = 20

### Request

```shell
curl --location --request GET 'http://localhost:8080/transfer/v1/schedule?page=0&size=20'
```

### Response

```shell
{"content":[{"id":1,"amount":30.00,"taxAmount":3.90,"transferDate":"2022-05-15","scheduleDate":"2022-05-15","accountSource":"114299997","accountDestination":"119318209"}],"pageable":{"sort":{"empty":true,"sorted":false,"unsorted":true},"offset":0,"pageNumber":0,"pageSize":20,"paged":true,"unpaged":false},"totalPages":1,"totalElements":1,"last":true,"size":20,"number":0,"sort":{"empty":true,"sorted":false,"unsorted":true},"first":true,"numberOfElements":1,"empty":false}
```

## Post (Salvar agendamento)

### Request

```shell
curl --location --request POST 'http://localhost:8080/transfer/v1/schedule' \
--header 'Content-Type: application/json' \
--data-raw '{
"amount":30,
"transferDate": "2022-05-15",
"accountSource": "114299997",
"accountDestination": "119318209"
}'
```

### Response

```shell
{
    "id": 1,
    "amount": 30,
    "taxAmount": 3.90,
    "transferDate": "2022-05-15",
    "scheduleDate": "2022-05-15",
    "accountSource": "114299997",
    "accountDestination": "119318209"
}
```

## Internacionaliza√ß√£o

As mensagens de erro da api s√£o internacionalizadas para portugu√™s e ingl√™s, para alterar √© necess√°rio passar a
header **Accept-Language** com os valores **pt-BR** ou **en-US**, ex.:

### Request (en-US)

```shell
curl --location --request POST 'http://localhost:8080/transfer/v1/schedule' \
--header 'Content-Type: application/json' \
--header 'Accept-Language: en-US' \
--data-raw '{
"transferDate": "2022-05-15",
"accountSource": "114299997",
"accountDestination": "119318209"
}'
```

### Response (en-US)

```shell
{
    "statusCode": 400,
    "message": "[The ammount cannot be empty]"
}
```

### Request (pt-BR)

```shell
curl --location --request POST 'http://localhost:8080/transfer/v1/schedule' \
--header 'Content-Type: application/json' \
--header 'Accept-Language: pt-BR' \
--data-raw '{
"transferDate": "2022-05-15",
"accountSource": "114299997",
"accountDestination": "119318209"
}'
```

### Response (pt-BR)

```shell
{
    "statusCode": 400,
    "message": "[O valor n√£o pode estar vazio]"
}
```

## Docs

- http://localhost:8080/transfer/docs
- http://localhost:8080/transfer/api-docs

## Actuator (monitoramento)

- Actuator: http://localhost:8080/transfer/actuator
- Info: http://localhost:8080/transfer/actuator/info
- Health check: http://localhost:8080/transfer/actuator/health
- Metrics: http://localhost:8080/transfer/actuator/metrics

---

## üõ† Tecnologias

As seguintes ferramentas foram usadas na constru√ß√£o do projeto:

#### [](https://github.com/ivanqueiroz/transfer-scheduler#server-springboot)**Server**

- **[Spring Boot](https://spring.io/projects/spring-boot)** ‚Äî Framework escolhido por ser _stand-alone_ e requerer menor esfor√ßo para iniciar o desenvolvimento das regras de neg√≥cio.
- **[Spring Data JPA](https://spring.io/projects/spring-data-jpa)** ‚Äî Escolhido para criar as opera√ß√µes com o banco de dados. Tamb√©m reduziu o esfor√ßo para iniciar o desenvolvimento por criar as
  opera√ß√µes mais comuns (_CRUD_).
- **[Spring Boot Actuator](https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html)** ‚Äî Permite a monitora√ß√£o da aplica√ß√£o remotamente. No Transfer Scheduler as permiss√µes s√£o:
  health, info, mappings, loggers, scheduledtasks e caches.
- **[Bean Validator](https://beanvalidation.org/2.0-jsr380/)** ‚Äî Utilizado para valida√ß√£o dos valores passados para a API, permite a verifica√ß√£o atrav√©s de anota√ß√µes.
- **[Lombok](https://projectlombok.org/)** ‚Äî Diminui a quantidade de c√≥digo escrito utilizando anota√ß√µes para gerar trechos comuns durante a compila√ß√£o.
- **[H2 Database](https://www.h2database.com/html/main.html)** ‚Äî Banco de dados em mem√≥ria (embedded). Para o prop√≥sito do projeto encaixou-se bem e √© o banco principal que registra os agendamentos.
- **[OpenAPI 3 & Spring Boot (Swagger)](https://springdoc.org/)** ‚Äî Plugin para o Spring Boot que gera a documenta√ß√£o da API do Transfer Scheduler.

> Veja o arquivo [build.gradle](https://github.com/ivanqueiroz/transfer-scheduler/blob/master/build.gradle)

---

## :triangular_ruler: Arquitetura

O Transfer Scheduler foi criado como uma API Rest visando a simplicidade de utiliza√ß√£o devido a popularidade do formato.

### Organiza√ß√£o dos arquivos (pacotes)

Baseados em princ√≠pios do DDD, a organiza√ß√£o do projeto √© dividido em duas grandes camadas:

- **application** ‚Äî Camada que cont√©m todos os arquivos referentes √†s camadas de intera√ß√£o com o usu√°rio e/ou relacionadas ao framework utilizado.
  - **config** ‚Äî cont√©m arquivos/classes de configura√ß√£o do projeto.
  - **web** ‚Äî subcamada de application que cont√©m toda a implementa√ß√£o web da aplica√ß√£o. Dentro da raiz desse package √© colocado
    coisas espec√≠ficas do framework tais como: controllers, filtros e classes para objeto de transfer√™ncia de dados entre camadas (dto's).
- **domain** ‚Äî Camada que encapsula e isola todas as regras de neg√≥cio do projeto, evitando ter depend√™ncias impl√≠citas ou
  expl√≠citas das outras camadas.
  - **entities** ‚Äî As entidades de neg√≥cio ficam aqui.
  - **repositories** ‚Äî Interfaces do [Spring Data JPA](https://spring.io/projects/spring-data-jpa) para a manipula√ß√£o das opera√ß√µes de banco.
  - **service** ‚Äî Classes que representam os servi√ßos de execu√ß√£o do neg√≥cio do sistema.
  - **factories** ‚Äî Classes de cria√ß√£o de inst√¢ncias de entities.
  - **exceptions** ‚Äî Classes que representa√ß√£o exce√ß√µes de neg√≥cio.

### Camadas l√≥gicas

O programa foi pensado em 3 camadas l√≥gicas:

- **Controller** ‚Äî Respons√°vel por responder as requisi√ß√µes. Nessa camada √© realizada as valida√ß√µes dos dados enviados ([Bean Validator](https://beanvalidation.org/2.0-jsr380/)) antes de serem
  transferidas para a camada de neg√≥cio e a padroniza√ß√£o da resposta de exce√ß√µes.
- **Service** ‚Äî Onde as regras de neg√≥cio e processamento s√£o executadas.
- **Repository** ‚Äî Camada respons√°vel pela persist√™ncia e manipula√ß√£o dos dados no banco de dados.

O Controller recebe as requisi√ß√µes dos clientes, realiza a valida√ß√£o dos dados, envia para a camada de servi√ßo. A camada de servi√ßo realiza a valida√ß√£o da consist√™ncia da informa√ß√£o passada e executa
a opera√ß√£o.
Ap√≥s a persist√™ncia a camada de servi√ßo devolve a transfer√™ncia salva. O ciclo √© encerrado com o retorno serializado em JSON pelo controller.
Caso haja um erro o mesmo √© tratado pelo handler de erros na camada web, que padroniza o JSON para a resposta.

O diagrama de sequ√™ncia de listagem de transfer√™ncias:

<p align="center" style="display: flex; align-items: flex-start; justify-content: center;">
  <img alt="Diagrama de Sequ√™ncia" title="#TransferSequence" src="./src/main/resources/static/images/sequence-transfer.png" width="711">
</p>

O diagrama de sequ√™ncia da a√ß√£o de salvar a transfer√™ncia:

<p align="center" style="display: flex; align-items: flex-start; justify-content: center;">
  <img alt="Diagrama de Sequ√™ncia" title="#TransferSequence" src="./src/main/resources/static/images/sequence-save-transfer.png" width="711">
</p>

### Design

Para atender ao requisito de permitir mudan√ßas e inclus√µes futuras, o c√≥digo foi desenhado para encapsular o algoritmo de c√°lculo das taxas dentro de classes e usar o polimorfismo para abstrair a
chamada ao c√≥digo.
As inst√¢ncias dos objetos que representam uma transfer√™ncia, s√£o realizadas por uma f√°brica, diminuindo o acoplamento entre as classes j√° que n√£o √© necess√°rio conhecer as implementa√ß√µes, as regras de
agendamento definem o tipo da transfer√™ncia e os mesmos definem qual o c√°lculo a ser utilizado.

O diagrama de classes:

<p align="center" style="display: flex; align-items: flex-start; justify-content: center;">
  <img alt="Diagrama de Classes" title="#TransferSchedulerClassDiagram" src="./src/main/resources/static/images/class-diagram.png" width="1724">
</p>

### Testes

Os testes criados s√£o:

- **TransferTypeFactoryTest** ‚Äî Realiza os testes da f√°brica dos tipos de Transfer.
- **CalculationTests** ‚Äî Testa a valida√ß√£o dos c√°lculos de taxas.

## ü¶∏ Autor

<a href="https://ivanqueiroz.dev">
 <img style="border-radius: 50%;" src="https://avatars.githubusercontent.com/u/680864?v=4" width="100px;" alt=""/>
 <br />
 <sub><b>Ivan Queiroz</b></sub></a> <a href="https://ivanqueiroz.dev" title="Blog Ivan Queiroz">üöÄ</a>
 <br />

[![Twitter Badge](https://img.shields.io/badge/-@ivanqueiroz-1ca0f1?style=flat-square&labelColor=1ca0f1&logo=twitter&logoColor=white&link=https://twitter.com/ivanqueiroz)](https://twitter.com/ivanqueiroz) [![Linkedin Badge](https://img.shields.io/badge/-Ivan-blue?style=flat-square&logo=Linkedin&logoColor=white&link=https://www.linkedin.com/in/ivanqueiroz/)](https://www.linkedin.com/in/ivanqueiroz/)
[![Gmail Badge](https://img.shields.io/badge/-ivanqueiroz@gmail.com-c14438?style=flat-square&logo=Gmail&logoColor=white&link=mailto:ivanqueiroz@gmail.com)](mailto:ivanqueiroz@gmail.com)

---

Feito com ‚ù§Ô∏è por Ivan Queiroz üëãüèΩ [Entre em contato!](https://www.linkedin.com/in/ivanqueiroz/)

---
